<include file="Public:header" />
<style>
			*{
				margin:0;
				padding:0;
			}
			.fileControl{
				position:relative;
				padding:5px;
			}
			.vqdTrigger{
				position:relative;
				width:60px;+
				height:25px;
				line-height:25px;
				text-align:center;
				border-radius:4px;
				background:#CC290E;
				color:#FFF;
				font-size:12px;
				border:none;
				cursor:pointer;
				outline:none;
			}
			.vqdfile{
				position:absolute;
				opacity:0;
			}
			.fileList li{
				position:relative;
				margin-top:5px;
				height:50px;
				padding:6px;
				display:block;
				border:1px solid #CCC;
				border-radius:4px;
			}
			.fileList li img{
				float:left;
				height:50px;
				display:block;
			}
			.fileList li .del{
				position:absolute;
				right:5px;
				top:20px;
				width:18px;
				height:18px;
				line-height:19px;
				text-align:center;
				border:1px solid #CCC;
				border-radius:20px;
				text-decoration:none;
				color:#888;
				font-size:16px;
			}
			.uploadSubmit{
				position:absolute;
				left:70px;
				top:5px;
				z-index:8;
				width:60px;
				height:25px;
				line-height:25px;
				text-align:center;
				border-radius:4px;
				background:#58BC40;
				color:#FFF;
				font-size:12px;
				border:none;
				cursor:pointer;
				outline:none;
				display:none;
			}

<!-- 我的添加-->
           ul li{
	             list-style:none;
            }
           .flyCheckBox{
	             width:140px;
	             height:35px;
	             border:1px solid #CCC;
	             border-radius:6px;
	             cursor:pointer;
	             background:#F4F4F4;
	             outline:none;
	             padding:0 5px;
	             float:left;
              }
            .flyBox{
	             position:fixed;
	             left:25%;
	             right:25%;
	             top:10%;
            	 max-height:320px;
            	 overflow:hidden;
	             z-index:1000;
	             padding:10px 20px 45px 20px;
	             border-radius:4px;
	             background:#FFF;
	             border:1px solid #CCC;
	             display:none;
              }
             .flyBox label{
	             margin-top:5px;
	             padding-bottom:5px;
	             width:100%;
             	 height:14px;
	             line-height:14px;
	             display:block;
	             border-bottom:1px dashed #ccc;
               }
               .flyBox input[type='checkbox']{
               	float:left;
               	margin-right:5px;

               }
               #to_id{
				width:100%;
               	height:100%;
               	min-height:200px;
               	max-height:250px;
               	overflow:scroll;
               	overflow-x:hidden;
               }
             .flyBox .foot{
	             width:100%;
	             padding:10px 0;
             	 height:21px;
	             text-align:center;
             	 position:absolute;
             	 bottom:0;
             	 left:0;
             	 background:#f4f4f4;
               }
               .flyBox .head{
				margin-bottom:20px;
				width:100%;
               	height:21px;
               }
               .flyBox .flyBox_close{
					font-size:16px;
               		float:right;
               	text-decoration:none;
               }
             .chk_submit .chk_reset{
	             width:60px;
	             height:22px;
	             background:#CCC;
	             border:1px solid #CCC;
	             border-radius:2px;
	             display:inline-block;
	             cursor:pointer;
                }
                .flyBox_trigger{
                	width:60px;
                	height:37px;
                	margin-right:10px;
                	float:left;
                	border-radius:4px;
                	border:1px solid #CCC;
                	background:#f4f4f4;
                	text-align:center;
                	cursor:pointer;
                	color:#555;
                }
				input[name='skuLocation[]'] {
					cursor:pointer;
					height: 18px;
					margin: 0 5px 0 0;
					padding: 5px;
					border: 1px solid #d0d0d0;
					background: #FFF url(../images/input.png) repeat-x;
					font-family: Verdana, Geneva, sans-serif,"微软雅黑";
					font-size: 12px;
				}
				
				.flybox1 {
					background:#fff;
					width:350px;
					border:1px solid #ccc;
					border-radius:6px;
					position:relative;
				}
				.flybox1:before,.bigCh:before {
					content: '';
					position: absolute;
					border: 1px dashed #ccc;
					top: 5px;
					bottom: 5px;
					left: 5px;
					right: 5px;
					-moz-box-shadow: 0 0 0 1px #fff;
					-webkit-box-shadow: 0 0 0 1px #fff;
					box-shadow: 0 0 0 1px #fff;
					border-radius: 4px;
					z-index:1;
				}
				.flyboxWrapper {
					padding:15px;
					z-index:2;
					position:relative;
				}
				.flyboxWrapper ul li {
					text-align:center;
					margin-bottom:10px;
				}
				.flyboxWrapper ul li label {
					line-height:30px;
					font-weight:bold;
					display:block;
				}
				.storeNo {
					position:relative;
					height:25px;
					line-height:25px;
					padding:0 5px;
					outline:none;
					border: 1px solid #d0d0d0;
					width: 100px;
					background: #FFF url(../images/input.png) repeat-x;
					font-family: Verdana, Geneva, sans-serif,"微软雅黑";
					font-size: 12px;
				}
				.inputHander {
					position:relative;
				}
				.btnplan {
					display:inline-block;
					text-align: center;
					margin-left: 100px;
				}
				.submitBtn {
					height: 30px;
					line-height: 30px;
					display: block;
					margin: 0 auto;
					text-align: center;
					color: #fff;
					font-size: 12px;
					background: #4f6e8f;
					float: left;
					padding: 0 10px;
					margin: 10px 5px 0 5px;
				}
				.closeui {
					font-weight: bold;
					position: absolute;
					right: 0;
					top: -4px;
					font-size: 20px;
					text-decoration:none;
					display:block;
				}
				.closeui:hover,.closeui:focus,.bigCh:hover,.bigCh:focus
				{
					text-decoration:none;
				}
				.coverbg {
					position:fixed;
					top:0;
					left:0;
					bottom:0;
					right:0;
					width:100%;
					height:100%;
					background:rgba(0,0,0,0.7);
					z-index:9998;
					display:none;
				}
				.bigCh {
					background:#fff;
					width:40px;
					height:40px;
					line-height:40px;
					text-align:center;
					color:#000;
					font-weight:bold;
					font-size:22px;
					display:block;
					border-radius:100%;
					position:absolute;
					top: -8px;
					right: -8px;
				}
				.bigCh:before {
					border-radius:100%;
				}
		</style>
<script type="text/javascript" src="__ROOT__/includes/ueditor/ueditor.config.js"></script>
<script type="text/javascript" src="__ROOT__/includes/ueditor/ueditor.all.min.js"></script>
<script type="text/javascript" src="__ROOT__/statics/js/jquery/plugins/jquery.imagePreview.js"></script>
<link rel="stylesheet" type="text/css" href="__ROOT__/statics/admin/css/jquery.datetimepicker.css"/>
<script type="text/javascript" src="__ROOT__/statics/admin/js/jquery.datetimepicker.js"></script>
<div class="flyBox">
	<div class="head"><a href="javascript:;" class="flyBox_close">×</a></a></div>
    <div id="to_id">
	</div>
	<div class="foot">
		<input type="button" class="chk_submit" value="确定" />
		<input type="button" class="chk_reset" value="清除" />
	</div>
</div>
<form action="{:u('Spu/edit')}" method="post" name="myform" onsubmit="return submitOnce(this)" id="myform" enctype="multipart/form-data" style="margin-top:10px;">
  <div class="pad-10">
    <div class="col-tab">
       <ul class="tabBut cu-li">
			<li id="tab_setting_1" class="on" onclick="SwapTab('setting','on','',3,1);">新增商品</li>
      </ul>
      <div id="div_setting_1" class="contentList pad-10">
        <table width="100%" cellpadding="2" cellspacing="1" class="table_form">
		  <input type="hidden" name="spu_id" value="{$spu.spu_id}">
          <tbody id="item_body">
          <tr>
            <th width="100">商品标题 :</th>
            <td><input type="text" name="title" id="title" class="input-text" size="60" value="{$spu.spu_name}"></td>
          </tr>
          <tr>
			<th>类目 :</th>
			<td>
                <input type="hidden" name="cateStr" id="cateStr" value=''>
                <select name="cate" id="cate" multiple="multiple" style="height:300px;width: 150px" onchange="get_brand(this,'brand');">
				<volist name="cate" id="val">
                <option value="{$val.id}" level="{$val.level}" <volist name="select_cate" id="vals"><if condition="$val['id'] eq $vals">selected="selected"</if></volist>>
                    {:str_repeat('&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;',$val['level'])}
                    {:trim($val['name'])}
                </option>
            	</volist>
              	</select>
            </td>
		  </tr>
		  <tr>
            <th width="100">品牌 :</th>
            <td><select name="brand" id="brand" width="120">
            <option value="0">--请选择--</option>
				<volist name='brand' id='val'>
                <option value='{$val.id}' <if condition="$spu.brand_id eq $val['brand_id']"> selected="selected"</if>>{$val.name}</option>
                </volist>
              	</select></td>
          </tr>
		  <tr>
          	<th>价格 :</th>
            <td><input type="text" name="pricenow" id="pricenow" class="input-text" size="10" onkeyup="if(isNaN(value))execCommand('undo')" onafterpaste="if(isNaN(value))execCommand('undo')" onchange="sycPrice(this.id)" value="{$spu.price_now}">元</td>
          </tr>
          <tr>
          	<th>超市价 :</th>
            <td><input type="text" name="priceold" id="priceold" class="input-text" size="10" onkeyup="if(isNaN(value))execCommand('undo')" onafterpaste="if(isNaN(value))execCommand('undo')" onchange="discount()" value="{$spu.price_old}">元</td>
          </tr>
          <tr>
            <th width="100">供货价格 :</th>
            <td><input type="text" name="supplierPrice" id="supplierPrice" class="input-text" size="10" onkeyup="if(isNaN(value))execCommand('undo')" onafterpaste="if(isNaN(value))execCommand('undo')" value="{$spu.suppliers_price}">元</td>
          </tr>
          <tr>
              <th width="100">虚拟销量 :</th>
              <td><input type="text" name="virtualSales" id="virtualSales" class="input-text" size="10" onkeyup="if(isNaN(value))execCommand('undo')" onafterpaste="if(isNaN(value))execCommand('undo')" value="{$spu.virtual_sales}">件</td>
          </tr>
          <tr>
              <th width="100">每人限购 :</th>
              <td><input type="text" name="limit" id="limit" class="input-text" size="10" onkeyup="if(isNaN(value))execCommand('undo')" onafterpaste="if(isNaN(value))execCommand('undo')" value="{$limit.limit_num}">件</td>
          </tr>
          <tr class="limit">
              <th width="100">限购生效时间 :</th>
              <td><input type="text" name="limit_start" id="limit_start" class="date datetimepicker" size="20" <if condition="$limit.start_time neq ''">value="{$limit.start_time|date='Y-m-d H:i:s',###}"</if>>
                  -&nbsp;<input type="text" name="limit_end" id="limit_end" class="date datetimepicker" size="20" <if condition="$limit.end_time neq ''">value="{$limit.end_time|date='Y-m-d H:i:s',###}"></if>></td>
          </tr>
          <tr>
              <th width="100">是否启用限购 :</th>
              <td>
                  <input type="radio" name="startLimit" value="1" <if condition="$limit.is_use eq 1">checked="checked"</if>/>是
                  <input type="radio" name="startLimit" value="0" <if condition="$limit.is_use eq 0">checked="checked"</if>/>否
              </td>
          </tr>
          <tr>
            <th width="100">供应商 :</th>
            <td><select name="supplier" id="supplier" onchange="get_shipping(this);" width="120">
				<option value="0">--没有供应商--</option>
				<volist name="supplier" id="val">
                <option value="{$val.suppliers_id}" <if condition="$val['suppliers_id'] eq $spu['suppliers_id']">selected="selected"</if>>
                {$val.suppliers_name}
                </option>
            	</volist>
              	</select></td>
          </tr>
           <tr>
            <th width="100">运费模板 :</th>
            <td><select name="shippingTemplate" id="shippingTemplate" width="120">
            {$shipping}
              	</select></td>
          </tr>
           <tr>
            <th width="100">归属活动模块 :</th>
            <td>{$spu.mod}</td>
          </tr>
          <tr>
            <th width="100">生产日期 :</th>
            <td><input type="text" name="date" id="date" class="input-text" size="20" value="{$spu.date}">（默认显示）</td>
          </tr>
          <tr>
            <th width="100">保质期 :</th>
            <td><input type="text" name="exp" id="exp" class="input-text" size="20" value="{$spu.exp}">个月</td>
          </tr>
          <tr>
            <th width="100">产地 :</th>
            <td><input type="text" name="place" id="place" class="input-text" size="20" value="{$spu.place}"></td>
          </tr>
          <tr>
            <th width="100">上架时间 :</th>
            <td><input type="text" name="time_publish" id="time_publish" class="date datetimepicker" size="20" value="{$spu.publish_time|date="Y-m-d H:i",###}"></td>
          </tr>
		  <tr>
			<th>商品标签（可多选） :</th>
			<td>
			<input type="checkbox" name="scene[]" value="1" {$spu['hot']}/>爆款零食&nbsp;&nbsp;
			<input type="checkbox" name="scene[]" value="2" {$spu['characteristic']}/>特色零食&nbsp;&nbsp;
			<input type="checkbox" name="scene[]" value="3" {$spu['edit']}/>需要编辑&nbsp;&nbsp;
            </td>
		  </tr>
		  <tr>
              <th width="100">活动标签（可多选） :</th>
              <td>
                  <input type="checkbox" name="free_delivery[]" <if condition="$spu.shipping_free eq 1">checked="checked"</if>/>包邮&nbsp;&nbsp;
                  <input type="checkbox" name="custom_tags[]" id="custom_tags" <if condition="$spu.tags_name neq ''">checked="checked"</if>/>自定义&nbsp;&nbsp;
                  <input type="text" name="tags_name" id="tags_name" value="{$spu.tags_name}" onkeyup="javascript:numChange();" placeholder="只能6个字之内" <if condition="$spu.tags_name eq ''">style="display: none"</if>>
              </td>
          </tr>
          <tr>
              <th width="100">是否认证 :</th>
              <td>
                  <input type="radio" name="auth" value="1" <if condition="1 eq $spu['is_auth']">checked="checked"</if>/>是
                  <input type="radio" name="auth" value="0" <if condition="0 eq $spu['is_auth']">checked="checked"</if>/>否
              </td>
          </tr>
          <tr>
          	<th width="150">通用缩略图 :</th>
            <td>
				<img src="{$spu['imgSmall']['url']}"  width='100' height='100'/>
				<a class="blueBtn" href="javascript:update_img({$spu['imgSmall']['id']},'通用缩略图',{$spu.spu_id},1)">修改</a>
			</div>
            </td>
            </tr>
          <tr>
          	<td>新增SKU :</td>
          </tr>
              </tbody>
        </table>
            <table width="100%" cellpadding="2" cellspacing="1" class="table_form" id="table">
			<tbody class="tbody-handle">
    		<tr>
                <td align="center">SKU名称</td>
                <td align="center">库存</td>
                <td align="center">价格</td>
                <td align="center">库位</td>
                <td align="center">商品标码</td>
                <td align="center">操作</td>
            </tr>
            <volist name="sku" id="val">
    		<tr class="sku_tr" id="sku_tr">
                <td align="center"><input type="text" name="skuName[]"  class="input-text" size="10" value="{$val.sku_name}"></td>
                <td align="center"><input type="text" name="skuSale[]"  class="input-text" size="10" value="{$val.sku_stocks}" <if condition="$isEditSku eq 1">readonly="readonly"</if>></td>
                <td align="center"><input type="text" name="skuPrice[]"  class="input-text" size="10" value="{$val.price}">元</td>
                <td align="center"><input type="text" name="skuLocation[]"  class="input-text" size="20" value="{$val.library_number}" readonly></td>
                <td align="center"><input type="text" name="skuCode[]"  class="input-text" size="20" value="{$val.sku_number}"></td>
               <!-- <td align="center"><input type="button" value="删除SKU" class="removeTr button"></td> -->
            </tr>
            </volist>
			</tbody>
			<tfoot>
            <tr>
            <td align="center">
            <input type="button" value="新增SKU" id="addSku" class="button">
			<label style="color:#c90000;font-weight:bold">Tips:点击库位框可以进行编辑操作</label>
            </td>
            </tr>
			</tfoot>
    		</table>
    		<table width="100%" cellpadding="2" cellspacing="1" class="table_form">
    		<tbody id="item_body">
    		 <tr>
	          <th>猜你喜欢 :</th>
	          <td width="86%"></td>
	       </tr>
              </tbody>
			</table>
          <table width="100%" cellpadding="2" cellspacing="1" class="table_form">
    		<tr>
                <td align="center">商品编号</td>
                <td align="center">商品标题</td>
              <!--   <td align="center">活动顺序</td> -->
                <td align="center">操作</td>
            </tr>
            <tbody id="insert">
            <volist name="guess" id="val">
    		<tr class="guess_tr" id="guess_tr">
    			<input type="hidden" name="guessId[]" value="{$val.love_id}">
                <td align="center">{$val.love_id}</td>
                <td align="center">{$val.spu_name}</td>
               <!--   <td align="center">上移<br/>下移</td> -->
                <td align="center"><input type="button" value="移除" onclick="delGuess({$val.love_id})" class="removeGuess button"></td>
            </tr>
            </volist>
            </tbody>
            <tr>
            <td align="center">
            <input type="button" value="猜你喜欢" id="addGuess" class="button">
            </td>
            </tr>
    		</table>
          <table width="100%" cellpadding="2" cellspacing="1" class="table_form">
           <tr>
			<th width='100'>现有的商品主图 :</th>
			<td>
			<volist name='imgMain' id='val'>
			<img src='{$val.url}' width='100'height='100'>
                <a class="blueBtn" href="javascript:update_img({$val.id},'通用缩略图',{$spu.spu_id},3)">修改</a>
			    <a class="blueBtn" href="javascript:del_pic({$val.id})">删除</a>
			</volist>
			</td>
		  </tr>
          <tr>
          	<th width="150">商品主图 :</th>
            <td>
				<div id="form4">
				<div class="fileControl">
					<input type="button" class="vqdTrigger" value="上传" />
					<input type="file" class="vqdfile" multiple="multiple" />
				</div>
				<ul class="fileList"></ul>
			</div>
            </td>
            </tr>
          <tr>
            <th>细节描述 :</th>
            <td><textarea name="info" id="info" style="width:90%;height:250px;">{$spu.details}</textarea></td>
          </tr>
           <tr>
           <th>
            <input type="submit" onclick="return checkSubmit()" value="立刻发布" name="dosubmit" class="button" id="dosubmit"></div>
    		</th>
    		</tr>
          </table>
		</div>
		<div class="coverbg"></div>
  </div>
</form>
<script>
	// edit by xiaobao 1104
	function centerpop(obj){
		var winHeight = $(window).height(), winWidth = $(window).width();
		var selfHeight = $(obj).height(), selfWidth = $(obj).width();
		$(obj).css({
			"position" : "fixed",
			"top" : winHeight/2 - selfHeight/2,
			"left" : winWidth/2 - selfWidth/2,
			"z-index" : 9999
		})
	}
	$("body").delegate("input[name='skuLocation[]']","click",function(){
		var val = $(this).val();
		var newarray = val.split("-");
		var htmls = '';
		htmls += '		  <div class="flybox1">';
		htmls += '	<div class="flyboxWrapper">';
		htmls += '		<a href="javascript:;" class="bigCh">×</a>';
		htmls += '		<ul>';
		htmls += '			<li style="width:48%;display:inline-block">';
		htmls += '				<label>库位号</label>';
		htmls += '			</li>';
		htmls += '			<li style="width:48%;display:inline-block">';
		htmls += '				<label>数量</label>';
		htmls += '			</li>';		
		htmls += '			<div class="cl"></div>';
		for(var i in newarray) {
			var no = newarray[i].split("*")[1];
			var num = newarray[i].split("*")[0];
			if(newarray[i].indexOf('*')<0) {
				num = 1,
				no = newarray[i];
			}
			htmls += '				<li>';
			htmls += '			<div class="inputHander">';
			htmls += '					<input type="text" name="storeNo[]" class="storeNo" value="'+no+'" />';
			htmls += '<input type="number" name="storeNumber[]" class="storeNo" value='+num+' style="margin-left: 38px;">';
			htmls += '					<a href="javascript:;" class="closeui">×</a>';
			htmls += '	</div>';
			htmls += '				</li>';
			htmls += '			<div class="cl"></div>';
		}
		htmls += '		</ul>';
		htmls += '		<div class="btnplan">';
		htmls += '			<a href="javascript:;" class="submitBtn suredone">确定</a>';
		htmls += '			<a href="javascript:;" class="submitBtn addone">新增一条</a>';
		htmls += '		</div>';
		htmls += '			</div>';
		htmls += '	</div>';
		$("body").append(htmls);
		$(".coverbg").show(),centerpop(".flybox1");
		$(".flybox1").attr('data-tags',$(this).parents("tr").index());
	})
	$("body").delegate(".closeui","click",function(){
		var len = $(".inputHander").length;
		len > 1 ? $(this).parents(".inputHander").remove() : alert("这是最后一条不能删除了哦！");
	})
	$("body").delegate(".flybox1 .addone","click",function(){
		var htmls = '';
		htmls += '	<li>';
		htmls += '			<div class="inputHander">';
		htmls += '					<input type="text" name="storeNo[]" class="storeNo"  />';
		htmls += '<input type="number" name="storeNumber[]" class="storeNo" style="margin-left: 38px;">';
		htmls += '					<a href="javascript:;" class="closeui">×</a>';
		htmls += '	</div>';
		htmls += '				</li>';
		htmls += '			<div class="cl"></div>';
		$(".flyboxWrapper ul").append(htmls);
	})
	$("body").delegate(".bigCh,.coverbg","click",function(){$(".flybox1").remove(),$(".coverbg").hide()})
	$("body").delegate(".suredone","click",function(){
		var array = [];
		var $p = $(".flyboxWrapper ul"),$li = $(".flyboxWrapper ul li");
		var a = $("input[name='storeNo[]']").val(),b = $("input[name='storeNumber[]']").val();
		if(a == "") {
			alert("请填写正确的库位号后在提交！");
		}else if(b == "" || isNaN(b)){
			alert("请填写正确的数量后在提交！");
		}else {
			$(".inputHander").each(function(){
				var a = $(this).find("input[name='storeNo[]']").val();
				var b = $(this).find("input[name='storeNumber[]']").val();
				var c = b > 1 ? b+"*"+a : a;
				array.push(c);
			});
			var tages = parseInt($(".flybox1").attr("data-tags"));
			var string = "";
			$(".coverbg").hide(),
			$(".flybox1").remove();
			for(var i=0;i<array.length;i++) {
				if(array.length>0){
					if(i<array.length-1){
						string += array[i] += "-";
					}else {
						string += array[i];
					}
				}else {
					string += array[i];
				}
			}
			var xhtml = '';
			xhtml = "<a href='javascript:;' class='inputLink'><input name='skuLocation[]' class='test skuLocationtsst' value="+string+" readonly></a>";
			$("#table tbody").find("tr").eq(tages).children("td:eq(3)").html(xhtml);
		}
	})
     function setVal(){
	    var self = $(".flyCheckBox"),
		box = $(".flyBox"),
		len = box.find("input[type='checkbox']").length,
		myVal = '',
		i = 0,
		arr = [];
	    len>0 && (box.find("input[type='checkbox']:checked").each(
		function(i){
			arr.push($(this).val());
		}
	     ),myVal = arr.join(","),self.val(myVal),box.hide());
      };
     function clearVal(){
	    var box = $(".flyBox"), len = box.find("input[type='checkbox']:checked").length;
	    len>0 && box.find("input[type='checkbox']:checked").each(function(){
		$(this).attr("checked",false);
	    });
      };

	function checkNum() {
		var number = document.getElementById("discount").value;
		var msg = "";
		var html = document.getElementById("errorMsg");
		if(isNaN(number)) {
			msg += "此处只能填写数字!";
			html.innerHTML = "<font color=\"red\">"+msg+"</font>";
		} else if (number.length == 0 ) {
			msg += "此处需要填写数字!";
			html.innerHTML = "<font color=\"red\">"+msg+"</font>";
		}else if (number > 10) {
			msg += "只能填写10以内的数字!";
			html.innerHTML = "<font color=\"red\">"+msg+"</font>";
		}
		else {
			html.innerHTML = "<font color=\"green\">填写正确!</font>";
		}
	}

	function checkSubmit() {
		var number = document.getElementById("discount").value;
		if(isNaN(number) || number.length == 0 || number > 10) {
			alert("折扣信息信息填写错误！");
			return false;
		}
	}
	function submitOnce() {
        var supplier = document.getElementById("supplier").value;
        var sku = document.getElementsByName("skuName[]");
        if(sku.length==0||!sku[0].value){
            alert("好歹要增加一个SKU啊！不能都为空！");
            return false;
        }
        if(supplier==0){
            alert("还没有选择供应商，如果还没确定供应商，请选择‘零食小喵’！");
            return false;
        }
        if($("#form4 .fileList").text().length>5){
            alert("商品主图不能超过5张！！");
            return false;
        }
	}
     function numChange(){

         $('#tags_name').val($('#tags_name').val().substring(0,6)); //自动截取

     }
	function update_img(id,name,cid,type) {
    	var lang_edit = "name";
    	window.top.art.dialog({id:'update_img'}).close();
    	window.top.art.dialog({title:'修改'+'--'+name,id:'update_img',iframe:'?m=Spu&a=update_img&id='+id+'&spu_id='+cid+'&type='+type,width:'500',height:'480'}, function(){var d = window.top.art.dialog({id:'update_img'}).data.iframe;d.document.getElementById('dosubmit').click();return false;}, function(){window.top.art.dialog({id:'update_img'}).close()});
	}
	function del_pic(id) { //删除图片
        var str = "确认要删除这张图片吗";
        if (confirm(str)) {
			window.location="{:u('Spu/del_pic','id=')}"+id;
        }
    }
	function delGuess(id){
		//alert(id);
		$.get('?m=Spu&a=asyncGuess&del=1&spu_id='+id,function(data){
			document.getElementById("insert").innerHTML = data;
		});
	}
	function sycPrice(id){
		var y = document.getElementById(id).value;
		var x = document.getElementsByName("skuPrice[]");
		for(var i=0;i<x.length;i++){
			x[i].value = y;
		}
	}
	function discount(){
		var y = document.getElementById("priceNow").value;
		var x = document.getElementById("priceOld").value;
	}
	function get_brand(obj,to_brand)
	{
		var parent_id = $(obj).val();
		document.getElementById("cateStr").value = parent_id;
		//alert(parent_id);
		if(parent_id!=null){
		    $.get('?m=Spu&a=getBrands&parent_id='+parent_id,function(data){
					var obj = eval("("+data+")");
					$('#'+to_brand).html( obj.content );
		    });
	    }else{
			var data = "{\"content\":\"<option value=0>--请选择--<\/option>\"}";
			var obj = eval("("+data+")");
			$('#'+to_brand).html( obj.content );
	    }
	}
</script>

<script type="text/javascript">
$(function(){
    $('.datetimepicker').datetimepicker({value:'',step:"30"});
})
function SwapTab(name,cls_show,cls_hide,cnt,cur){
    for(i=1;i<=cnt;i++){
		if(i==cur){
			 $('#div_'+name+'_'+i).show();
			 $('#tab_'+name+'_'+i).attr('class',cls_show);
		}else{
			 $('#div_'+name+'_'+i).hide();
			 $('#tab_'+name+'_'+i).attr('class',cls_hide);
		}
	}
}

function get_tags()
{
    var title = $("#title").val();
	var url = "{:u('items/get_tags')}";
	$.get(url,{ title: title },function(data){
	    var return_data  = eval("("+data+")");
		$("#tags").val(return_data.data);
	});
}

function get_shipping(obj)
{
	var parent_id = $(obj).val();
	if(parent_id!=null){
	    $.get('?m=Spu&a=get_shipping&supplier='+parent_id,function(data){
				$('#shippingTemplate').html( data );
				//alert(data);
	    });
    }else{
		var data = "{\"content\":\"<option value=0>--请选择--<\/option>\"}";
		var obj = eval("("+data+")");
		$('#shippingTemplate').html( obj.content );
    }
}
$(function(){
	//fly check box
	$(".flyBox_close").on("click",function(){
		var box = $(".flyBox");
		box.hide();
	})
	$(".flyBox_trigger").on("click",function(){
		var box = $(".flyBox");
		var father = document.getElementById('cate');
		//alert(father);return;
		//alert(father.length);return;
		//alert(father[0].value);return;
		str_id = "";
		for(var i = 0 ; i < father.length ; i++){
			//alert("ff");return;
			if(father[i].selected == true){
				//alert("123");return;
				str_id = str_id + father[i].value + ',';
			}
		}
		if(str_id){
			//alert("ff");
			$.get('?m=goods&a=getfav&guess_id='+str_id,function(data){
				$('#to_id').html(data);
				//alert(data);
			});
		}
		box.show();
	});
	$(".chk_submit").on("click",setVal);
	$(".chk_reset").on("click",clearVal);

	//timepicker
	$('.datetimepicker').datetimepicker({value:'',step:"30"});
	$(".is_search").on("click",function(){
		$(".hot_name").show();
	})
	$(".is_search_n").on("click",function(){
		$(".hot_name").hide();
	})
    $("#custom_tags").on("click",function(){
        var is_show = $("#custom_tags").attr("checked");
        if(is_show =='checked'){
            $("#tags_name").show();
        }else{
            $("#tags_name").hide();
        }

    })

		    $.formValidator.initConfig({
		        formid:"myform",
		        autotip:true,
		        onerror:function(msg,obj){
		            window.top.art.dialog({
		                content:msg,
		                lock:true,
		                width:'250',
		                height:'50'}, function(){
		                    this.close();$(obj).focus();
		                    submitone =false;
		                    })}});

		    $("#title").formValidator({
		        onshow:"输入商品名称，不能为空",
		        onfocus:"不能为空"
		        }).inputValidator({
		            min:1,
		            onerror:"请填写商品称"
		            });

		    $("#url").formValidator({
		        onshow:"淘宝地址，不能为空",
		        onfocus:"不能为空"
		        }).inputValidator({
		            min:1,
		            onerror:"请填写淘宝地址"
		            });
		    $("#time_start").formValidator({
		        onshow:"发布时间不能为空",
		        onfocus:"不能为空"
		        }).inputValidator({
		            min:1,
		            onerror:"请填写发布时间"
		            });
		     $("#img_s").formValidator({
		        onshow:"商品缩略图不能为空",
		        onfocus:"正在上传..."
		        }).inputValidator({
		            min:1,
		            onerror:"请上传商品缩略图"
		            });
		     $("#img_l").formValidator({
		        onshow:"商品长版横图不能为空",
		        onfocus:"正在上传..."
		        }).inputValidator({
		            min:1,
		            onerror:"请上传商品长版横图"
		            });
            $("#pricenow").formValidator({
                onshow:"当前价格，不能为空",
                onfocus:"不能为空"
            }).inputValidator({
                min:1,
                onerror:"请填写价格"
            });
            $("#priceold").formValidator({
                onshow:"超市价格，不能为空",
                onfocus:"不能为空"
            }).inputValidator({
                min:1,
                onerror:"请填写超市价格"
            });
            $("#supplierPrice").formValidator({
                onshow:"供应商价格，不能为空",
                onfocus:"不能为空"
            }).inputValidator({
                min:1,
                onerror:"请填写供应商价格"
            });
            $("#place").formValidator({
                onshow:"产地不能为空",
                onfocus:"不能为空"
            }).inputValidator({
                min:1,
                onerror:"请输入产地"
            });

		})
</script>
<script>
			(function($) {
				$.fn.upload = function(options) {
					var opts = $.extend({}, $.fn.upload.defaults, options);
					return this.each(function() {
						var $this = $(this);
						var o = $.meta ? $.extend({}, opts, $this.data()) : opts;
						var index = 0;
						var father = o.self;
						var del = "#" + o.self + " .del";
						var trigger = "#" + o.self + " .vqdTrigger";
						var fileInput = "#" + o.self + " .vqdfile";
						//event
						$("body").on("click",del,{m:father},fileDel);
						$("body").on("change",fileInput,{m:father,f:o.fileName},fileTrigger);
						$("body").on("click",trigger,{m:father},fileClick);
					});
				};
				function fileClick(e){
					var self = e.data.m;
					$("#"+self+" .vqdfile").trigger("click");
				};
				function fileTrigger(e){
					var master = $("#"+e.data.m);
					var filename = e.data.f;
					var self = $(this)[0];
					var myfile = self.files;
					var myfileLen = myfile.length;
					var reader = new FileReader();
					var fileHiddenHtml;
					var fileHtml = '<input type="file" multiple="multiple" class="vqdfile" />';
					var replace = function(i){
						var index = i ? i : 0;
						var fileListHtml = '';
						if(index < myfileLen){
							console.log(index,myfileLen);
							reader.readAsDataURL(myfile[index]);
							reader.onload = function(e) {
								fileHiddenHtml = '<input type="hidden" name="'+filename+'[]" class="fileHidden" data-index="'+index+'" value="'+e.target.result+'" />';

								fileListHtml += '<li>';
								fileListHtml += '<img src="'+e.target.result+'" />';
								fileListHtml += '<a href="javascript:;" class="del" data-id="'+index+'">×</a>';
								fileListHtml += '</li>';

								master.find(".fileControl").append(fileHiddenHtml);
								master.find(".fileList").append(fileListHtml);
								master.find(".uploadSubmit").show();

								//fileArr.push(e.target.result);
								index++;
								replace(index);
							}
						}else{
							master.find(".vqdfile").remove();
							master.find(".fileControl").append(fileHtml);
							index = 0;
							console.log("上传成功");
						}
					};
					replace();
				};
				function fileDel(e){
					var master = $("#"+e.data.m),
						$self = $(this),
						selfLi = $self.closest("li"),
						selfIndex = $self.attr("data-id"),
						liLen = master.find(".fileList li").length;

					liLen <= 1 && master.find(".uploadSubmit").hide();
					//var changeArr = [];
					//for(var i in fileArr){
					//	if(i != selfIndex){
					//		changeArr.push(fileArr[i]);
					//	}
					//}
					master.find(".fileHidden[data-index="+selfIndex+"]").remove();
					//fileArr = changeArr;
					selfLi.remove();
				};
				// defaults
				$.fn.upload.defaults = {
					self : "",
					fileName : "file",
				};
			})(jQuery);

			$("#form1").upload({self:"form1"});
			$("#form2").upload({self:"form2",fileName:"imgs"});
			$("#form3").upload({self:"form3",fileName:"imgss"});
			$("#form4").upload({self:"form4",fileName:"imgsss"});
		</script>
<script type="text/javascript">

    //实例化编辑器
    //建议使用工厂方法getEditor创建和引用编辑器实例，如果在某个闭包下引用该编辑器，直接调用UE.getEditor('editor')就能拿到相关的实例
    var ue = UE.getEditor('info');



</script>
<script type="text/javascript">
    $("#is_image").change(function(){
        var select = $("input:radio[name='is_image']:checked").val();
        if(select == 1){
            $("#activity_image").show();
        }else{
            $("#activity_image").hide();
        }
    });
</script>
<script type="text/javascript">

		$("#addSku").click(function(){
			var value = $("#pricenow").val() ? $("#pricenow").val() : '';
			var htmls = '';
			htmls += '<tr class="sku_tr" id="sku_tr">';
            htmls += '<td align="center"><input type="text" name="skuName[]"  class="input-text" size="10" value=""></td>';
            htmls += '<td align="center"><input type="text" name="skuSale[]"  class="input-text" size="10" value=""></td>';
            htmls += '<td align="center"><input type="text" name="skuPrice[]"  class="input-text" size="10" value="'+value+'">元</td>';
            htmls += '<td align="center"><input type="text" name="skuLocation[]"  class="input-text" size="20" value=""></td>';
            htmls += '<td align="center"><input type="text" name="skuCode[]"  class="input-text" size="20" value=""></td>';
            htmls += '<td align="center"><input type="button" value="删除SKU" class="removeTr button"></td>';
            htmls += '</tr>';
			$("#table .tbody-handle").append(htmls);
		});
		$("#addGuess").click(function(){
			var lang_edit = "猜你喜欢";
    		window.top.art.dialog({id:'guess'}).close();
    		window.top.art.dialog({title:'猜你喜欢',id:'guess',iframe:'?m=Spu&a=addGuess',width:'900',height:'580'},
    		function(){
    		var d = window.top.art.dialog({id:'guess'}).data.iframe;
    		d.document.getElementById('myform').submit();
    		setTimeout(function(){$.get('?m=Spu&a=asyncGuess&type=1',function(data){
				//document.getElementById('insert').innerHTML(data);
				//alert(data);
				//var old = document.getElementById("insert").innerHTML;
				document.getElementById("insert").innerHTML = data;
				//alert(document.getElementById("insert").innerHTML);
				window.top.art.dialog({id:'guess'}).close();
			})}, 500);
    		return false;
    		}, function(){window.top.art.dialog({id:'guess'}).close();});
		});
		$("body").delegate(".removeTr","click",removeTr);
		function removeTr(e){
		var self = $(this), parent = self.parents(".sku_tr") ,wrap = $("#table>tbody>tr");
		if(wrap.length > 3){
			parent.remove();
		}else if(wrap.length == 3){
			alert("这是最后一条不能删除了哦!~");
			return;
		}
	}
</script>

</body></html>